<p>As a regular (and passionate) iOS user with a strong belief in the Web, I beta-test any and all new iOS builds as soon as I can get my hands on them. My main motivation is to see how they do when it comes to Progressive Web App features. Each new iOS version comes with a new version of Safari, yet changes in Safari tend to almost never get highlighted in the iOS release notes (and the <a href="https://developer.apple.com/documentation/ios_release_notes/ios_12_2_beta_release_notes">12.2 beta 1 release notes</a> were no exception). So my routine is to fire up my <a href="https://tomayac.github.io/pwa-feature-detector/">ğŸ•µï¸â€â™‚ï¸ PWA Feature Detector</a>â€”a simple testing tool described in an accompanying <a href="https://ai.google/research/pubs/pub46739">ğŸ“„ research paper</a>â€”and to look for potential changes myself.</p>
<p><img src="img/1__K6ceGyUXEhWnAzkB4F7Vfw.png" alt="Research paper â€œWhat is in a Web View? An Analysis of Progressive Web App Features When the Means of Web Access is not a Web Browserâ€.">
<a href="https://ai.google/research/pubs/pub46739">Research paper</a> â€œWhat is in a Web View? An Analysis of Progressive Web App Features When the Means of Web Access is not a Web Browserâ€.</p>
<h4>Web Share API SupportÂ (ğŸ˜ƒ)</h4>
<p>For the last couple of releases, there were only <a href="https://twitter.com/tomayac/status/1003910651151085568">two checkmarks</a> â€˜âœ”â€™ for â€œOffline Capabilitiesâ€ and â€œPayment Request,â€ however 12.2 beta 1 had a surprise present: the PWA Feature Detector tool reported that now â€œWeb Shareâ€ is supported, too. The <a href="https://wicg.github.io/web-share/">Web Share APIâ€Šâ€”â€ŠLevel 1</a> defines an API for sharing text, links, and other content to an arbitrary destination of the userâ€™s choice. I tested it with the official <a href="https://wicg.github.io/web-share/demos/share.html">demo</a> and it worked like a charm! This is brilliant news, thanks Apple ğŸ‰!</p>
<p><img src="img/1__XqPH5rTYeRCF6vumHnhgfA.png" alt="ğŸ•µï¸â€â™‚ï¸ PWA Feature Detector running on iOS 12.2 beta 1, showing support for the Web Share API (left) and the Web Share API in action with this demoÂ (right).">
<a href="https://tomayac.github.io/pwa-feature-detector/">ğŸ•µï¸â€â™‚ï¸ PWA Feature Detector</a> running on iOS 12.2 beta 1, showing support for the Web Share API (left) and the Web Share API in action with this <a href="https://wicg.github.io/web-share/demos/share.html">demo</a>Â (right).</p>
<h4>Out-of-Scope Links in â€œAdd to Home Screenâ€ AppsÂ (ğŸ˜ƒ)</h4>
<p>If you add an app to the home screen on iOS, it runs in an environment called Web.app. As far as I can tell, there is no public documentation about it, but Apple engineers alike <a href="https://bugs.webkit.org/show_bug.cgi?id=183800#c2">use</a> this term to refer to it. The problem so far was that apps opened in the regular Safari as soon as an out-of-scope link was clicked, leading to the app <a href="https://bugs.webkit.org/show_bug.cgi?id=185400">losing its state completely</a> (also see the next paragraph).</p>
<p>This has changed now, and links finally open in something that looks like a customized <code>SFSafariViewController</code>, however, without the share sheet, no reload button, andâ€”even if it would triggerâ€”no reader mode button. I am not an iOS programmer, but looking at the <a href="https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller/configuration">documentation of</a> <code>[SFSafariViewController.Configuration](https://developer.apple.com/documentation/safariservices/sfsafariviewcontroller/configuration)</code> and judging from how I have seen <code>SFSafariViewController</code> be used in the past, this seems to not be a user-configurable setup.</p>
<p><img src="img/1__u29Xfl3rHHfuHRcJwEp3xw.jpeg" alt="Out-of-scope link viewed in Twitter Lite PWA (left) and in the native Twitter app (right). There is no reload button and no share sheet, and also no reader mode button in the new experience on theÂ left.">
Out-of-scope link viewed in <em>Twitter Lite PWA (left) and</em> in the native Twitter app (right). There is no reload button and no share sheet, and also no reader mode button in the new experience on theÂ left.</p>
<h4>Keeping State When Multitasking (ğŸ˜ƒ)</h4>
<p>I have kept the maybe biggest change for the end. It seems like there is work underway to finally <strong>make PWAs that are added to the home screen to keep state</strong>. For the context, before, when you were multitasking away from an app that was added to the home screen and then came back, it would always reload and lose its state completely. I have reported this issue in <a href="https://bugs.webkit.org/show_bug.cgi?id=185400">WebKit bug 185400</a>, but it was closed because the core issue is not in WebKit.</p>
<p>This appears to be changing for the better ğŸŠ. I have tried the new experience with <a href="https://mobile.twitter.com/">Twitter Lite</a>, where I started a tweet, multitasked to a different app, and then came back to find my previously started tweet ready to be continued. As a second example in the screenshot series below, you can see me searching for a hotel in <a href="https://trivago.com/">trivagoâ€™s PWA</a>, then going back to the home screen, and finally switching back to the app to find my search state preserved.</p>
<p>In many cases the screenshot in Appleâ€™s multitasking UI was still just a white screen, but in some cases it actually reflected the last state. Hopefully this will be improved in future betas.</p>
<p>âš ï¸ Preserving state seems to work sometimes, but not always, and occasionally I was trapped within a view in Twitterâ€™s app and could not tap on any UI element, even if a back button was there; or I was brought back to the start screen of trivagoâ€™s app and had to redo my search.</p>
<blockquote>
<p>Side note: for apps that do not provide their own back button and relied on Androidâ€™s system-level back button (see our <a href="https://github.com/w3c/manifest/issues/693">related work on a media query to detect this issue</a>), this behavior can mean that they are now permanently locking in their users. So always make sure you provide a back button ğŸ”™Â .</p>
</blockquote>
<p><img src="img/1__o3D3ZgPoh3m4GWW7vsyj1Q.jpeg" alt="First trivagoâ€™s PWA shown at 13:11 oâ€™clock (left), then switching back to the home screen (middle), and finally with restored state at 13:12 oâ€™clockÂ (right).">
First trivagoâ€™s PWA shown at 13:11 oâ€™clock (left), then switching back to the home screen (middle), and finally with restored state at 13:12 oâ€™clockÂ (right).</p>
<h4>Still Not Respecting the Web App Manifest IconsÂ (ğŸ˜•)</h4>
<p>Where there is light, there is shadow (but just a little). <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest#icons">Icons specified in the Web App Manifest</a> are still being ignored. You have to use the Apple old-school way to <a href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html">configure Web Applications</a> with link relations as outlined in the code sample below (or just use <a href="https://medium.com/u/6c30b61e6e3c">Sam Thorogood</a>â€™s <a href="https://github.com/GoogleChromeLabs/pwacompat">PWACompat</a> library).</p>
<link rel="apple-touch-icon" href="touch-icon-iphone.png">  
<link rel="apple-touch-icon" sizes="152x152" href="ipad.png">  
<link rel="apple-touch-icon" sizes="180x180" href="iphone-2x.png">  
<link rel="apple-touch-icon" sizes="167x167" href="ipad-2x.png">
<p>I have a little test tool called <a href="https://ios-a2hs-demo.glitch.me/">iOS Add to Home Screen</a> that in its <a href="https://ios-a2hs-demo.glitch.me/manifest.webmanifest">manifest</a> lists gazillions (well, almost) of differently sized icons, but the one iOS ends up using is still the Safari-generated screenshot-based one.</p>
<p><img src="img/1__U4TBUHxhCkNLUTep9i5zlQ.png" alt="iOS Add to Home Screen tool (left) showing iOS still ignores icons specified in its Web App ManifestÂ (right).">
<a href="https://ios-a2hs-demo.glitch.me/">iOS Add to Home Screen</a> tool (left) showing iOS still ignores icons specified in <a href="https://ios-a2hs-demo.glitch.me/manifest.webmanifest">its Web App Manifest</a>Â (right).</p>
<h4>Media Capabilities API and Intersection Observer As Experimental FeaturesÂ (ğŸ˜ƒ)</h4>
<p>I want to continue this post on a positive note, so here are a couple more surprises: several new APIs made it in Safariâ€™s â€œExperimental WebKit Featuresâ€ list (in the Settings app, navigate to â€œSafari &gt; Advanced &gt; Experimental Featuresâ€ to activate them). I want to highlight the <a href="https://wicg.github.io/media-capabilities/">Media Capabilities API</a> that allows websites to make an optimal decision when picking media content for the user. The API exposes information about the decoding and encoding capabilities for a given format, but also output capabilities to find the best match based on the deviceâ€™s display. I tested the API with this <a href="https://googlechrome.github.io/samples/media-capabilities/decoding-info.html">demo</a> that on my MacBook Pro says I am good to go, but on my iPhone X tells me the configuration is not supported.</p>
<p><img src="img/1__RSOejcNRPEe__jIU7bhsi__w.jpeg" alt="Media Capabilities API support is the forth checkmark in PWA Feature Detector (left). The demo (right) lets the app know that the media configuration will not be supported, not play smoothly, and not be power efficient.">
Media Capabilities API support is the forth checkmark in <a href="https://tomayac.github.io/pwa-feature-detector/">PWA Feature Detector</a> (left). The <a href="https://googlechrome.github.io/samples/media-capabilities/decoding-info.html">demo</a> (right) lets the app know that the media configuration will not be supported, not play smoothly, and not be power efficient.</p>
<h4>Other New FeaturesÂ (ğŸ˜ƒ)</h4>
<p>A second (not PWA-related, yet still important in the context) API that was added as an experiment is <code>IntersectionObserver</code>, an API which is essential for performant <a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/">lazy-loading of images, videos, or iframes</a>. Safari is really <a href="https://caniuse.com/#feat=intersectionobserver">late to the game</a> on this one, but after the desktop Safari Technology Previews gained support in <a href="https://webkit.org/blog/8479/release-notes-for-safari-technology-preview-69/">version 69</a>, it is finally great to have this API hopefully soon in Mobile Safari, too, once it graduates from its current experimental status, and to no longer have to rely on the <a href="https://github.com/w3c/IntersectionObserver/tree/master/polyfill">polyfill</a>.</p>
<p>What is also new (but is likewise not exactly a PWA feature) is <code>input[type=color]</code> support. Playing with the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/color">demo</a>, I would maybe wish for long-press support for more granular color selection, but the current implementation probably works well enough for most use cases.</p>
<p><img src="img/1__Sksx4YCYLicViQ7RjzeMBw.png" alt=" in action on thisÂ demo.">
<input type=â€colorâ€> in action on thisÂ <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/color">demo</a>.</p>
<h4>Conclusion and Call to ActionÂ (ğŸ‰)</h4>
<p>Concluding, this is <strong>one heck of a release for Progressive Web Apps</strong>, and I am really happy that Apple engineers are listening to user feedback. Another example of this is <a href="https://medium.com/u/8a074e41efcc">Henrik Joreteg</a>â€™s recent <a href="https://twitter.com/HenrikJoreteg/status/1089059979670089729">positive experience</a> with getting the <code>[HTMLAnchorElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement/download)</code><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement/download">â€™s</a> <code>[download](https://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement/download)</code> attribute added, so one can now easily create downloads dynamically.</p>
<p>While admittedly at times it might feel like shouting into a forrest, <a href="https://webkit.org/reporting-bugs/">sending feedback</a> helps, or as ï£¿ WebKit engineer <a href="https://twitter.com/chris_dumez">Chris Dumez</a> put itâ€¦</p>
<p>ğŸ“¢ So here is my call to action for universally great PWA support to all Safari users out there: <strong>let us keep the WebKit team busy by filing bugs and commenting on existing ones</strong>! They are listening! With experimental features included, <a href="https://tomayac.github.io/pwa-feature-detector/">ğŸ•µï¸â€â™‚ï¸ PWA Feature Detector</a> now makes Safari have four checkmarks â€˜âœ”â€™, here is to the WebKit team to add some more!</p>
<p>ğŸ‘‰ If you want <strong>Push Notifications</strong> support, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=182566">WebKit Bug 182566</a>.<br>
ğŸ‘‰ If you want <strong>Background Sync</strong> support, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=182565">WebKit Bug 182565</a>.<br>
ğŸ‘‰ If you want <strong>Storage Estimation</strong> support, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=185405">WebKit Bug 185405</a>.<br>
âœ… <strong>(Fixed)</strong> If you want <code>**getUserMedia**</code> support for PWAs, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=185448">WebKit Bug 185448</a>.<br>
ğŸ‘‰ If you want <strong>Web App Manifest icons</strong> for PWAs, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=183937">WebKit Bug 183937</a>.<br>
ğŸ‘‰ If you want <strong>Add to Home Screen</strong> support for PWAs, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=193959">WebKit bug 193959</a>.<br>
ğŸ‘‰ If you want <strong>Web Share Target API</strong> support, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=194593">WebKit bug 194593</a>.<br>
ğŸ‘‰ If you want <strong>Web Share APIâ€Šâ€”â€ŠLevel 2</strong> support (file sharing), chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=198606">WebKit bug 198606</a>.<br>
ğŸ‘‰ If you want <strong>Navigation Preload API</strong> support, chime in on <a href="https://bugs.webkit.org/show_bug.cgi?id=182852">WebKit bug 182852</a>.</p>
<p>â˜ï¸ If you <strong>do not see your issue</strong>, <a href="https://webkit.org/new-bug">file a new bug</a> ğŸ†•. Duplication is fine according to the WebKit team. Use a company email address, tell them why and who needs the feature, and how many of your iOS users are missing out.</p>
<p><strong>Update:</strong> Appleâ€™s <a href="https://twitter.com/othermaciej">Maciej Stachowiak</a> clarified the following points about how the team would like to receive feedback on their bug tracker:</p>
<h4>Acknowledgements</h4>
<p>There are a couple of like-minded iOS beta nerds ğŸ¤“ out there who have helped unearth or get more details on some of these features. I was in Twitter discussions with <a href="https://twitter.com/mhartington">Mike Hartington</a>, <a href="https://twitter.com/firt">Maximiliano Firtman</a> (ğŸ™‹â€â™‚ï¸ read <a href="https://medium.com/@firt/pwas-on-ios-12-2-beta-the-good-the-bad-and-the-not-sure-yet-if-good-a37b6fa6afbf">Maxâ€™ article</a> on the same subject), <a href="https://twitter.com/simevidas">Å ime Vidas</a>, and <a href="https://twitter.com/samthor">Sam Thorogood</a>. Thank you!</p>
